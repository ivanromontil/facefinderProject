<script>
    async function sendDataToCosmosDB(id, data) {
      try {
        const response = await fetch('/api/createEntry', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ id, data })
        });
  
        if (response.ok) {
          const result = await response.json();
          console.log('Data sent to Cosmos DB:', result);
        } else {
          throw new Error('Failed to send data to Cosmos DB');
        }
      } catch (error) {
        console.error(error);
      }
    }
  
    function processImage() {
      var subscriptionKey = "1c8a0938df024623a98b21251f299565";
      var uriBase =
          "https://feelfinderai.cognitiveservices.azure.com/face/v1.0/detect";
  
      // Request parameters.
      var params = {
          "detectionModel": "detection_03",
          "returnFaceId": "true"
      };
  
      // Display the image.
      var sourceImageUrl = document.getElementById("inputImage").value;
      document.querySelector("#sourceImage").src = sourceImageUrl;
  
      // Perform the REST API call.
      $.ajax({
          url: uriBase + "?" + $.param(params),
  
          // Request headers.
          beforeSend: function (xhrObj) {
              xhrObj.setRequestHeader("Content-Type", "application/json");
              xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key", subscriptionKey);
          },
  
          type: "POST",
  
          // Request body.
          data: '{"url": ' + '"' + sourceImageUrl + '"}',
      })
  
          .done(function (data) {
              // Show formatted JSON on webpage.
              $("#responseTextArea").val(JSON.stringify(data, null, 2));
  
              // Draw rectangles around detected faces
              var canvas = document.getElementById("canvas");
              var context = canvas.getContext("2d");
              context.clearRect(0, 0, canvas.width, canvas.height);
              var img = document.getElementById('sourceImage');
              canvas.width = img.width*2;
              canvas.height = img.height*2;
              context.drawImage(img, 0, 0);
              context.strokeStyle = 'red';
              context.lineWidth = 2;
              data.forEach(function (face) {
                  var faceRectangle = face.faceRectangle;
                  context.beginPath();
                  context.rect(faceRectangle.left, faceRectangle.top, faceRectangle.width, faceRectangle.height);
                  context.stroke();
              });
  
              // Send data to Cosmos DB
              sendDataToCosmosDB('some-unique-id', data);
          })
  
          .fail(function (jqXHR, textStatus, errorThrown) {
              // Display error message.
              var errorString = (errorThrown === "") ?
                  "Error. " : errorThrown + " (" + jqXHR.status + "): ";
              errorString += (jqXHR.responseText === "") ?
                  "" : (jQuery.parseJSON(jqXHR.responseText).message) ?
                      jQuery.parseJSON(jqXHR.responseText).message :
                      jQuery.parseJSON(jqXHR.responseText).error.message;
              alert(errorString);
          });
    };
  </script>
  